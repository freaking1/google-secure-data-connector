#!/bin/bash

# If sshd < 3.7 adjust UseDNS option to older property of VerifyReverseMapping
sshd_config=_SSHDCONF_
declare -i sshd_ver
declare -i sshd_UseDNS

# Set sshd version to 37 for version 3.7
sshd_UseDNS=37
sshd_UseTCPKeepAlive=38
sshd_CompressionDelayed=41


# Get sshd version and convert it to integer i.e version 3.6 = 36
sshd_ver=`sshd -v 2>&1 | grep -i openssh_ | awk -F _ '{ print $2 }' | awk -F . '{ print $1 substr($2,1,1) }  '`

if [ $sshd_ver = 0 ]; then
 echo "Could not determine sshd version number. You might have to edit your config_sshd file manually"
 exit 0
fi

#sshd 3.7 changed directive  VerifyReverseMapping to UseDNS
if [ $sshd_ver -lt $sshd_UseDNS ]; then
  # sed replace option UseDNS with option VerifyReverseMapping in sshd_config
  echo "Adjusting SSHD_Config for older sshd property: VerifyReverseMapping"
  sed -i ${sshd_config} -e 's^UseDNS^VerifyReverseMapping^'
fi

# sshd 3.8 changed directive KeepAlive to TCPKeepAlive
if [ $sshd_ver -lt $sshd_UseTCPKeepAlive ]; then
  echo "Adjusting SSHD_Config for older sshd property: KeepAlive"
  sed -i ${sshd_config} -e 's^TCPKeepAlive yes^KeepAlive yes^'
fi
# sshd 4.1 introduced new option Compression delayed
if [ $sshd_ver -lt $sshd_CompressionDelayed ]; then
  echo "Adjusting SSHD_Config for older sshd property: Compression yes"
  sed -i ${sshd_config} -e 's^Compression delayed^Compression yes^'
fi

